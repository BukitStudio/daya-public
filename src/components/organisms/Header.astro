---
import Hamburger from "../atoms/Hamburger.astro";
import MainMenu from "./MainMenu.astro";
import Daya from "../../assets/icons/logo/daya.svg";
---

<header class="header">
  <nav class="nav" aria-label="Main navigation">
    <Daya width={70} />
    <Hamburger />
  </nav>

  <MainMenu />
</header>

<style>
  .header {
    width: 100%;
    display: flex;
    padding: 1rem;
    z-index: 9999;
    position: sticky;
    top: 0rem;
    background-color: var(--primary-700);
  }

  .header svg {
   min-width: 1.5rem;
    min-height: 1.5rem;
  }
  nav {
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    align-items: center;
    width: 100%;
    margin-left: auto;
  }

  .header.header--hidden {
    transform: translateY(-120%);
    opacity: 0;
    pointer-events: none;
  }
</style>

<script>
  const logoBtn = document.querySelector(".header");
  const menu = document.getElementById("main-menu");
  const nav = document.querySelector(".nav");
  if (logoBtn && menu && nav) {
    function setMenuTabbable(isOpen: boolean) {
      if (!menu) return;
      const links = menu.querySelectorAll("a, button, input, select, textarea");
      links.forEach((link) => {
        (link as HTMLElement).tabIndex = isOpen ? 0 : -1;
      });
    }
    logoBtn.addEventListener("click", (e) => {
      e.stopPropagation();
      const expanded = logoBtn.getAttribute("aria-expanded") === "true";
      logoBtn.setAttribute("aria-expanded", String(!expanded));
      menu.setAttribute("aria-hidden", String(expanded));
      menu.hidden = expanded;
      setMenuTabbable(!expanded);
    });
    // Ensure menu is hidden initially
    menu.setAttribute("aria-hidden", "true");
    menu.hidden = true;
    setMenuTabbable(false);

    document.addEventListener("click", (e) => {
      if (!nav.contains(e.target as Node)) {
        logoBtn.setAttribute("aria-expanded", "false");
        menu.setAttribute("aria-hidden", "true");
        menu.hidden = true;
        setMenuTabbable(false);
      }
    });
  }

  // Hide header on scroll down, show on scroll up
  let lastScrollY = window.scrollY;
  let ticking = false;
  function onScroll() {
    if (!logoBtn) return;
    const currentScrollY = window.scrollY;
    if (currentScrollY > lastScrollY && currentScrollY > 40) {
      logoBtn.classList.add("header--hidden");
    } else {
      logoBtn.classList.remove("header--hidden");
    }
    lastScrollY = currentScrollY;
    ticking = false;
  }
  window.addEventListener("scroll", () => {
    if (!ticking) {
      window.requestAnimationFrame(onScroll);
      ticking = true;
    }
  });
</script>

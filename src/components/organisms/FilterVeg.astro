---
import SwitchVeg from "../atoms/SwitchVeg.astro";
---

<div class ="filter-switch-container mt2 ">

<div class="filter-switch narrow">
  <p class="mb0">Mode végétarien <span id="veg-mode-status" ></span></p>
  <SwitchVeg id="filter-switch" />
</div>

</div>
<style>
  .filter-switch-container{
    background: var(--primary-600);
    padding: 1rem 2rem;
    transition: transform .8s cubic-bezier(0.4,0,0.2,1);
  }
  .filter-switch-container.scroll-up {
    transform: translateY(60px);
  }
  .filter-switch{
    display: flex;
    justify-content: space-between;
    align-items: center;
    -webkit-tap-highlight-color: transparent;
}
@media screen and (max-width: 768px) {
    .filter-switch-container{
      padding: 0.5rem 1rem;
    }
}

:global(.hidden-product) {
  display: none !important;
}

</style>

<script>
// Wait for DOM and Astro hydration
window.addEventListener('DOMContentLoaded', function() {
  // Use setTimeout to ensure SwitchVeg is rendered
  setTimeout(function() {
    const filterSwitch = document.getElementById('filter-switch');
    if (!filterSwitch || filterSwitch.tagName !== 'INPUT') return;
    const checkbox = filterSwitch as HTMLInputElement;
    function updateFilter() {
      // Select all product <li> elements directly under .products-list
      const items = document.querySelectorAll('.products-list > li');
      items.forEach(li => {
        const item = li as HTMLElement;
        const cat = item.dataset.category || '';
        if (!(checkbox as HTMLInputElement).checked) {
          item.classList.remove('hidden-product');
        } else {
          if (cat.includes('veg')) {
            item.classList.remove('hidden-product');
          } else {
            item.classList.add('hidden-product');
          }
        }
      });
      // Update veg mode status
      const status = document.getElementById('veg-mode-status');
      if (status) {
        status.textContent = checkbox.checked ? 'on' : 'off';
      }
    }
    checkbox.addEventListener('change', updateFilter);
    // Initial state
    updateFilter();
  }, 0);
});

// Add scroll-up transform logic (same as FoodNav)
// window.addEventListener('DOMContentLoaded', function() {
//   const filterBar = document.querySelector('.filter-switch-container');
//   if (!filterBar) return;
//   let lastScrollY = window.scrollY;
//   window.addEventListener('scroll', () => {
//     const currentScrollY = window.scrollY;
//     if (currentScrollY === 0) {
//       filterBar.classList.remove('scroll-up');
//     } else if (currentScrollY < lastScrollY) {
//       filterBar.classList.add('scroll-up');
//     } else {
//       filterBar.classList.remove('scroll-up');
//     }
//     lastScrollY = currentScrollY;
//   });
// });
</script>


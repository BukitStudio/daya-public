---
import SwitchVeg from "../atoms/SwitchVeg.astro";
---


<div class="filter-switch-container narrow">
  <p>Mode végétarien</p>
  <SwitchVeg id="filter-switch" />
</div>

<style>
.filter-switch-container{
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: none;
    -webkit-tap-highlight-color: transparent;
}
@media screen and (max-width: 768px) {
  .filter-switch-container {
    margin-top: 0.5rem;
    margin-bottom: 0.5rem;
  }
}


</style>

<script>
// Wait for DOM and Astro hydration
window.addEventListener('DOMContentLoaded', function() {
  // Use setTimeout to ensure SwitchVeg is rendered
  setTimeout(function() {
    const filterSwitch = document.getElementById('filter-switch');
    if (!filterSwitch || filterSwitch.tagName !== 'INPUT') return;
    const checkbox = filterSwitch as HTMLInputElement;
    function updateFilter() {
      // Select all product <li> elements directly under .products-list
      const items = document.querySelectorAll('.products-list > li');
      items.forEach(li => {
        const item = li as HTMLElement;
        const cat = item.dataset.category || '';
        if (!(checkbox as HTMLInputElement).checked) {
          item.classList.remove('hidden-product');
        } else {
          if (cat.includes('veg')) {
            item.classList.remove('hidden-product');
          } else {
            item.classList.add('hidden-product');
          }
        }
      });
    }
    checkbox.addEventListener('change', updateFilter);
    // Initial state
    updateFilter();
  }, 0);
});
</script>

<style>
:global(.hidden-product) {
  display: none !important;
}
</style>
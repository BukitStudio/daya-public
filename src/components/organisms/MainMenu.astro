---
import BtnLink from "../molecules/BtnLink.astro";
import Info from "../../data/info.json";
import ClickCollectIcon from "../../assets/icons/clickCollect.svg";
import WhatsappIcon from "../../assets/icons/whatsapp.svg";
import GmapsIcon from "../../assets/icons/gmaps.svg";
import WazeIcon from "../../assets/icons/waze.svg";

import SocialLinks from "../molecules/SocialLinks.astro";
---

<div id="main-menu" class="main-menu" tabindex="-1" hidden>
  <div class="main-menu-links">
    <p class="uppercase">Commander</p>
    <ul class="link-group">
      <li>
        <BtnLink
          href={Info.clickCollect}
          background="#E84349"
          color="#fff"
          ariaLabel="Click and Collect"
          icon={ClickCollectIcon}
          text="Click & Collect"
        />
      </li>

      <li>
        <BtnLink
          href={Info["order-tel"]}
          background="#28D366"
          color="#000000"
          ariaLabel="WhatsApp"
          icon={WhatsappIcon}
          text="WhatsApp"
        />
      </li>
    </ul>
    <p class="uppercase mt1">Nous trouver</p>
    <ul class="link-group">
      <li>
        <BtnLink
          href={Info.gmaps}
          background="#F6F6F6"
          color="#404040"
          ariaLabel="Google Maps"
          icon={GmapsIcon}
          text="Google Maps"
          iconSize="1em"
        />
      </li>
      <li>
        <BtnLink
          href={Info.waze}
          background="#3CCEFE"
          color="#000000"
          ariaLabel="Waze"
          icon={WazeIcon}
          text="Waze"
          iconSize="1em"
        />
      </li>
    </ul>
  </div>

  <div class="main-menu-info-container">
  <div class="main-menu-info">
    <p class="p-l bold center mb0">DAYA HENDAYE</p><p>{Info.address}</p>
      
    <p class="center neutral-500 mb0" set:html={Info.operatingHours.replace(/\n/g, '<br>')}></p>

    </div>
    <div class="social-links-container">
      <SocialLinks />
    </div>
<script>
// Prevent body scroll when main menu is open
window.addEventListener('DOMContentLoaded', function() {
  const menu = document.getElementById('main-menu');
  const observer = new MutationObserver(() => {
    if (!menu) return;
    if (menu.getAttribute('aria-hidden') === 'false') {
      document.body.style.overflow = 'hidden';
    } else {
      document.body.style.overflow = '';
    }
  });
  if (menu) {
    observer.observe(menu, { attributes: true, attributeFilter: ['aria-hidden'] });
  }
});
</script>
  </div>

<style>
  .main-menu {
    position: absolute;
    display: flex;
    background-color: var(--primary-600);
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
   
    top: 120%;
    right: 1rem;
    min-width: 350px;
    border-radius: 1rem;
    overflow: hidden;
    box-shadow:
      0 8px 32px 0 rgba(0, 0, 0, 0.64),
      0 1.5px 8px 0 rgba(1,29,22,0.18),
      0 0 0 9999px rgba(9, 15, 14, 0.85);
    list-style: none;
    opacity: 0;
    transform: translateY(-10px);
    transition:
      opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1),
      transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    pointer-events: none;
    z-index: -1;
    outline: none;
  }

  .main-menu-links {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    width: 100%;
    gap: 1rem;

    padding: 2rem 1.2rem;
  }

  .link-group{
    width: 100%;
  }
  .main-menu li {
    margin-bottom: 0.5rem;
    width: 100%;
  }
  .main-menu li:last-child {
    margin-bottom: 0;
  }

  .main-menu[aria-hidden="false"] {
    opacity: 1;
    transform: translateY(0);
    pointer-events: auto;
    
  }


  .main-menu li {
    margin-bottom: 0.5rem;
  }
  .main-menu li:last-child {
    margin-bottom: 0;
  }

  .main-menu a:hover {
    box-shadow:
      0 4px 24px 0 rgba(6, 43, 33, 0.471),
      0 1.5px 8px 0 rgba(1, 29, 22, 0.725);
    transform: translateY(-2px) scale(1.01);
    transition:
      box-shadow 0.2s,
      transform 0.2s;
  }

  .main-menu-links a:focus {
    outline: 2px solid var(--secondary-500);
    outline-offset: 2px;
  }


  .main-menu-info-container{
    width: 100%;
        background-color: var(--primary-700);
 
  }
  .main-menu-info {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background-color: var(--primary-700);
    padding: 1.5rem 1rem;

  }


  .social-links-container {
    display: flex;
    flex-direction: row;
    align-items: center;
    justify-content: center;
    width:100%;
    background-color: var(--primary-600);
 padding: 1rem;
  }


  .social-links svg {
    width: 2rem;
  }



</style>


<script>
// Close menu when clicking or focusing outside
window.addEventListener('DOMContentLoaded', function() {
  const menu = document.getElementById('main-menu');
  function closeMenu() {
    if (!menu) return;
    menu.setAttribute('aria-hidden', 'true');
    menu.setAttribute('hidden', '');
  }
  function handlePointerDown(e) {
    if (!menu) return;
    if (menu.getAttribute('aria-hidden') === 'true') return;
    if (!menu.contains(e.target)) {
      closeMenu();
    }
  }
  function handleFocusIn(e) {
    if (!menu) return;
    if (menu.getAttribute('aria-hidden') === 'true') return;
    if (!menu.contains(e.target)) {
      closeMenu();
    }
  }
  document.addEventListener('mousedown', handlePointerDown);
  document.addEventListener('touchstart', handlePointerDown);
  document.addEventListener('focusin', handleFocusIn);
});
</script>